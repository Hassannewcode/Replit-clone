<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Replit AI Web Creator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        :root {
            --bg-darkest: #1a1a1a;
            --bg-darker: #2c2c2c;
            --bg-medium: #3e3e3e;
            --bg-light-contrast: #4f4f4f; /* Renamed for clarity */
            --text-light: #e0e0e0;
            --text-medium: #b0b0b0;
            --text-dark: #1a1a1a;
            --accent-primary: #6c7a89; /* Muted blue-gray */
            --accent-secondary: #95a5a6; /* Lighter muted blue-gray */
            --success: #2ecc71;
            --warning: #f39c12;
            --danger: #e74c3c;
            --code-bg: #222222;

            /* Retaining original names for compatibility where direct replacement is not ideal,
               but mapping them to the new palette. */
            --primary: var(--accent-primary);
            --secondary: var(--accent-secondary);
            --accent: var(--accent-secondary); /* Or choose a specific accent if needed */
            --dark: var(--bg-darker);
            --darker: var(--bg-darkest);
            --light: var(--text-light);
            --sidebar: var(--bg-medium);
        }
        
        body {
            background: linear-gradient(135deg, var(--bg-darkest), var(--bg-darker));
            color: var(--text-light);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        header {
            background: rgba(44, 44, 44, 0.8); /* --bg-darker with alpha */
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(224, 224, 224, 0.1); /* --text-light with alpha */
            display: flex;
            align-items: center;
            padding: 0 20px;
            height: 60px;
            z-index: 100;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .logo i {
            color: var(--accent-primary);
            font-size: 24px;
        }
        
        .logo h1 {
            font-size: 22px;
            background: linear-gradient(to right, var(--accent-secondary), var(--accent-primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }
        
        .header-controls {
            margin-left: auto;
            display: flex;
            gap: 15px;
        }
        
        .btn {
            background: rgba(108, 122, 137, 0.2); /* accent-primary with alpha */
            border: 1px solid var(--accent-primary);
            color: var(--text-light);
            padding: 8px 16px;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            background: var(--accent-primary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(108, 122, 137, 0.3); /* accent-primary with alpha */
        }
        
        .btn i {
            font-size: 14px;
        }
        
        .btn-run {
            background: var(--success);
            border-color: var(--success);
        }
        
        .btn-run:hover {
            background: #27ae60; /* Darker green */
        }
        
        .main-container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        aside {
            width: 350px;
            background: var(--sidebar); /* Mapped to --bg-medium */
            border-right: 1px solid rgba(224, 224, 224, 0.1); /* --text-light with alpha */
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid rgba(224, 224, 224, 0.1); /* --text-light with alpha */
        }
        
        .tab-btn {
            flex: 1;
            padding: 15px;
            background: transparent;
            border: none;
            color: var(--text-light);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .tab-btn.active {
            background: rgba(108, 122, 137, 0.2); /* accent-primary with alpha */
            border-bottom: 3px solid var(--accent-primary);
        }
        
        .tab-content {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }
        
        .tab-pane {
            display: none;
            flex: 1;
            flex-direction: column;
        }
        
        .tab-pane.active {
            display: flex;
        }
        
        .chat-container {
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: rgba(26, 26, 26, 0.5); /* --bg-darkest with alpha */
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .message {
            max-width: 85%;
            padding: 12px 16px;
            border-radius: 18px;
            line-height: 1.5;
            position: relative;
            animation: fadeIn 0.3s ease;
        }
        
        .message.user {
            background: rgba(108, 122, 137, 0.3); /* accent-primary with alpha */
            border: 1px solid var(--accent-primary);
            align-self: flex-end;
        }
        
        .message.ai {
            background: rgba(44, 44, 44, 0.8); /* --bg-darker with alpha */
            border: 1px solid rgba(224, 224, 224, 0.1); /* --text-light with alpha */
            align-self: flex-start;
        }
        
        .message.thinking {
            color: var(--text-medium);
            font-style: italic;
            background: rgba(44, 44, 44, 0.5); /* --bg-darker with alpha */
        }
        
        .message .timestamp {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 5px;
            text-align: right;
        }
        
        .chat-input {
            display: flex;
            gap: 10px;
        }
        
        .chat-input input {
            flex: 1;
            padding: 12px 15px;
            border-radius: 30px;
            border: 1px solid rgba(224, 224, 224, 0.1); /* --text-light with alpha */
            background: rgba(26, 26, 26, 0.5); /* --bg-darkest with alpha */
            color: var(--text-light);
            outline: none;
            transition: border 0.3s ease;
        }
        
        .chat-input input:focus {
            border-color: var(--accent-secondary);
        }
        
        .chat-input button {
            background: var(--accent-primary);
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .chat-input button:hover {
            background: var(--accent-secondary);
            transform: scale(1.05);
        }
        
        .rules-container, .json-container {
            background: rgba(26, 26, 26, 0.5); /* --bg-darkest with alpha */
            padding: 20px;
            border-radius: 10px;
            flex: 1;
            overflow-y: auto;
        }
        
        .rules-container h3, .json-container h3 {
            margin-bottom: 15px;
            color: var(--accent-secondary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .rules-section {
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 1.1rem;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid var(--accent-primary);
            color: var(--accent-secondary);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .rules-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .rule-item {
            background: rgba(44, 44, 44, 0.8); /* --bg-darker with alpha */
            padding: 12px 15px;
            border-radius: 8px;
            border-left: 3px solid var(--accent-primary);
            transition: transform 0.2s ease;
        }
        
        .rule-item:hover {
            transform: translateX(5px);
        }
        
        .rule-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--accent-secondary);
        }
        
        pre {
            background: var(--code-bg);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-size: 14px;
            line-height: 1.5;
            color: #dcdcdc; /* Slightly adjusted for code readability */
            max-height: 500px;
        }
        
        .editor-area {
            flex: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .editor-header {
            padding: 15px 20px;
            border-bottom: 1px solid rgba(224, 224, 224, 0.1); /* --text-light with alpha */
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(44, 44, 44, 0.8); /* --bg-darker with alpha */
        }
        
        .editor-header h2 {
            font-size: 18px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .editor-header i {
            color: var(--accent-secondary);
        }

        .editor-header-left-group {
            display: flex;
            align-items: center;
            gap: 25px; /* Increased gap for better separation */
        }

        .url-fetcher-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        #urlInput {
            padding: 7px 15px; /* Adjusted padding */
            border-radius: 20px;
            border: 1px solid var(--bg-light-contrast);
            background: var(--bg-darker);
            color: var(--text-light);
            min-width: 280px;
            font-size: 0.85rem; /* Slightly smaller font */
            line-height: 1.4;
        }
        #urlInput::placeholder {
            color: var(--text-medium);
            opacity: 0.6;
        }

        #fetchUrlButton {
            padding: 7px 15px;
            font-size: 0.85rem;
        }
        #fetchUrlButton i {
            font-size: 0.9em; /* Adjusted icon size */
            margin-right: 5px;
        }


        .layout-controls {
            display: flex;
            gap: 10px;
            /* margin-left: 20px; /* Removed, handled by editor-header-left-group gap */
        }

        .layout-btn i { /* Ensure icons in layout buttons are not too small */
            font-size: 1em;
        }
        
        .editor-content {
            display: flex;
            flex: 1;
            overflow: hidden; /* Default is row */
        }

        /* Specific layout class will be on editor-area */
        .editor-area.layout-preview-top .editor-content {
            flex-direction: column-reverse;
        }
        .editor-area.layout-editor-top .editor-content {
            flex-direction: column;
        }

        .editor-area.layout-editor-top .editor-panel,
        .editor-area.layout-editor-top .preview-panel,
        .editor-area.layout-preview-top .editor-panel,
        .editor-area.layout-preview-top .preview-panel {
            height: 50%;
            flex-grow: 1; /* Allow them to grow to fill the column space */
            flex-basis: 0; /* Reset basis for even distribution */
        }
        
        .editor-panel, .preview-panel {
            flex: 1;
            background: rgba(44, 44, 44, 0.8); /* --bg-darker with alpha */
            display: flex;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid rgba(224, 224, 224, 0.1); /* --text-light with alpha */
        }
        
        .panel-header {
            padding: 10px 15px;
            border-bottom: 1px solid rgba(224, 224, 224, 0.1); /* --text-light with alpha */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .panel-header h3 {
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .panel-header i {
            color: var(--accent-secondary);
            font-size: 14px;
        }
        
        .panel-content {
            flex: 1;
            overflow: hidden;
        }
        
        .code-editor {
            width: 100%;
            height: 100%;
            padding: 15px;
            background: var(--code-bg);
            color: var(--text-light); /* Using text-light for editor text */
            border: none;
            outline: none;
            resize: none;
            font-family: 'Fira Code', monospace;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .preview-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* Responsive design */
        @media (max-width: 1200px) {
            aside {
                width: 300px;
            }
        }

        function genericCodeModification() {
            const timestamp = new Date().toLocaleString();
            const comment = `\n    <!-- AI performed a generic modification at ${timestamp} -->`;
            let currentCode = htmlEditor.value;

            // Try to add the comment inside the body, or at the end of the head if body not found.
            let insertPosition = currentCode.indexOf('</body>');
            if (insertPosition === -1) {
                insertPosition = currentCode.indexOf('</head>');
            }
            if (insertPosition === -1) { // Fallback: add to the end
                insertPosition = currentCode.length;
            }

            const newCode = currentCode.substring(0, insertPosition) +
                            comment +
                            currentCode.substring(insertPosition);
            if (htmlEditor.value !== newCode) {
                htmlEditor.value = newCode;
                updatePreview(); // Ensure preview is updated
            }
        }
        
        @media (max-width: 900px) {
            .main-container {
                flex-direction: column;
            }
            
            aside {
                width: 100%;
                height: 300px;
            }
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(224, 224, 224, 0.05); /* --text-light with alpha */
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 4px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--accent-secondary);
        }
        
        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .ai-typing-indicator {
            display: flex;
            gap: 5px;
        }
        
        .ai-typing-indicator span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent);
            display: inline-block;
            animation: bounce 1.5s infinite ease-in-out both;
        }
        
        .ai-typing-indicator span:nth-child(1) {
            animation-delay: -0.32s;
        }
        
        .ai-typing-indicator span:nth-child(2) {
            animation-delay: -0.16s;
        }
        
        @keyframes bounce {
            0%, 80%, 100% { 
                transform: scale(0);
            }
            40% { 
                transform: scale(1.0);
            }
        }
        
        .tool-tag {
            display: inline-block;
            background: rgba(76, 201, 240, 0.2);
            border: 1px solid var(--accent);
            color: var(--accent);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            margin-right: 5px;
        }
        
        .tool-used {
            margin-top: 10px;
            font-size: 0.8rem;
            opacity: 0.8;
            font-style: italic;
        }
        
        .tool-used i {
            margin-right: 5px;
            color: var(--accent);
        }
        
        .ai-tool {
            display: inline-block;
            background: rgba(59, 130, 246, 0.2);
            color: #3b82f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.7rem;
            margin: 0 2px;
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">
            <i class="fas fa-robot"></i>
            <h1>Replit AI Web Creator</h1>
        </div>
        <div class="header-controls">
            <button class="btn" id="save-btn">
                <i class="fas fa-save"></i> Save
            </button>
            <button class="btn btn-run" id="run-btn">
                <i class="fas fa-play"></i> Run
            </button>
        </div>
    </header>
    
    <div class="main-container">
        <aside>
            <div class="tab-buttons">
                <button class="tab-btn active" data-tab="chat">AI Chat</button>
                <button class="tab-btn" data-tab="rules">Rules</button>
                <button class="tab-btn" data-tab="json">JSON Tools</button>
            </div>
            
            <div class="tab-content">
                <div class="tab-pane active" id="chat-tab">
                    <div class="chat-container">
                        <div class="chat-messages" id="chat-messages">
                            <div class="message ai">
                                <strong>AI Assistant:</strong> Hello! I'm your Replit AI assistant. I'm here to help you build software with minimal back-and-forth. How can I assist you today?
                                <div class="timestamp">Just now</div>
                            </div>
                            <div class="message user">
                                Create a responsive website with a hero section and features
                                <div class="timestamp">Just now</div>
                            </div>
                            <div class="message ai">
                                <strong>AI Assistant:</strong> I've created a responsive homepage with a hero section and three feature cards. The design is mobile-friendly and uses modern CSS techniques. You can see it in the preview panel.
                                <div class="tool-used"><i class="fas fa-tools"></i> Used: <span class="ai-tool">str_replace_editor</span>, <span class="ai-tool">restart_workflow</span></div>
                                <div class="timestamp">Just now</div>
                            </div>
                            <div class="message user">
                                Can you add a dark mode toggle?
                                <div class="timestamp">Just now</div>
                            </div>
                            <div class="message ai">
                                <strong>AI Assistant:</strong> Dark mode toggle added! I've implemented a theme switcher that saves user preference to localStorage. Check the code editor for the implementation.
                                <div class="tool-used"><i class="fas fa-tools"></i> Used: <span class="ai-tool">str_replace_editor</span>, <span class="ai-tool">bash</span></div>
                                <div class="timestamp">Just now</div>
                            </div>
                        </div>
                        
                        <div class="chat-input">
                            <input type="text" id="chat-input" placeholder="Ask the AI assistant...">
                            <button id="send-btn">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="tab-pane" id="rules-tab">
                    <div class="rules-container">
                        <h3><i class="fas fa-book"></i> AI Operational Rules</h3>
                        
                        <div class="rules-section">
                            <div class="section-title"><i class="fas fa-user-tie"></i> Role: Expert Software Developer (Editor)</div>
                            <div class="rules-list">
                                <div class="rule-item">
                                    <div class="rule-title">Primary Focus</div>
                                    <div>Build software on Replit for the user with minimal back-and-forth</div>
                                </div>
                                <div class="rule-item">
                                    <div class="rule-title">Iteration Process</div>
                                    <div>Iterate back and forth with the user on their request. Report progress using the appropriate tool.</div>
                                </div>
                                <div class="rule-item">
                                    <div class="rule-title">Communication Policy</div>
                                    <div>Use plain language, avoid jargon, and explain complex concepts when necessary</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="rules-section">
                            <div class="section-title"><i class="fas fa-cogs"></i> Operating Principles</div>
                            <div class="rules-list">
                                <div class="rule-item">
                                    <div class="rule-title">Prioritize Replit Tools</div>
                                    <div>Avoid virtual environments, Docker, or containerization</div>
                                </div>
                                <div class="rule-item">
                                    <div class="rule-title">App Functionality</div>
                                    <div>After changes, check app functionality using feedback tools</div>
                                </div>
                                <div class="rule-item">
                                    <div class="rule-title">File Operations</div>
                                    <div>Use search_filesystem tool to locate files and directories</div>
                                </div>
                                <div class="rule-item">
                                    <div class="rule-title">Database Operations</div>
                                    <div>Use execute sql tool for debugging PostgreSQL database errors</div>
                                </div>
                                <div class="rule-item">
                                    <div class="rule-title">Proactiveness</div>
                                    <div>Suggest improvements and anticipate user needs without explicit requests</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="rules-section">
                            <div class="section-title"><i class="fas fa-shield-alt"></i> Data Integrity Policy</div>
                            <div class="rules-list">
                                <div class="rule-item">
                                    <div class="rule-title">Data Accuracy</div>
                                    <div>Ensure all data used is accurate, complete, and from authentic sources</div>
                                </div>
                                <div class="rule-item">
                                    <div class="rule-title">Error Handling</div>
                                    <div>Implement robust error handling to prevent data corruption</div>
                                </div>
                                <div class="rule-item">
                                    <div class="rule-title">Validation</div>
                                    <div>Validate user inputs and data from external sources</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="tab-pane" id="json-tab">
                    <div class="json-container">
                        <h3><i class="fas fa-tools"></i> AI Tools Configuration</h3>
                        <pre id="json-tools">{
  "tools": [
    {
      "name": "restart_workflow",
      "description": "Restart (or start) a workflow.",
      "parameters": {
        "properties": {
          "name": {
            "description": "The name of the workflow.",
            "type": "string"
          }
        },
        "required": ["name"],
        "type": "object"
      }
    },
    {
      "name": "search_filesystem",
      "description": "This tools searches and opens the relevant files for a codebase",
      "parameters": {
        "properties": {
          "class_names": {
            "default": [],
            "description": "List of specific class names to search for in the codebase. Case-sensitive and supports exact matches only. Use this to find particular class definitions or their usages.",
            "items": {"type": "string"},
            "type": "array"
          },
          "code": {
            "default": [],
            "description": "List of exact code snippets to search for in the codebase. Useful for finding specific implementations or patterns. Each snippet should be a complete code fragment, not just keywords.",
            "items": {"type": "string"},
            "type": "array"
          },
          "function_names": {
            "default": [],
            "description": "List of specific function or method names to search for. Case-sensitive and supports exact matches only. Use this to locate function definitions or their invocations throughout the code.",
            "items": {"type": "string"},
            "type": "array"
          },
          "query_description": {
            "anyOf": [{"type": "string"}, {"type": "null"}],
            "default": null,
            "description": "A natural language query to perform semantic similarity search. Describe what you're looking for using plain English, e.g. 'find error handling in database connections' or 'locate authentication middleware implementations'."
          }
        },
        "type": "object"
      }
    },
    {
      "name": "str_replace_editor",
      "description": "Custom editing tool for viewing, creating and editing files\n* State is persistent across command calls and discussions with the user\n* If `path` is a file, `view` displays the result of applying `cat -n`. If `path` is a directory, `view` lists non-hidden files and directories up to 2 levels deep\n* The `create` command cannot be used if the specified `path` already exists as a file\n* If a `command` generates a long output, it will be truncated and marked with `<response clipped>` \n* The `undo_edit` command will revert the last edit made to the file at `path`",
      "parameters": {
        "properties": {
          "command": {
            "description": "The commands to run. Allowed options are: `view`, `create`, `str_replace`, `insert`, `undo_edit`.",
            "enum": ["view", "create", "str_replace", "insert", "undo_edit"],
            "type": "string"
          },
          "file_text": {
            "description": "Required parameter of `create` command, with the content of the file to be created.",
            "type": "string"
          },
          "insert_line": {
            "description": "Required parameter of `insert` command. The `new_str` will be inserted AFTER the line `insert_line` of `path`.",
            "type": "integer"
          },
          "new_str": {
            "description": "Optional parameter of `str_replace` command containing the new string (if not given, no string will be added). Required parameter of `insert` command containing the string to insert.",
            "type": "string"
          },
          "old_str": {
            "description": "Required parameter of `str_replace` command containing the string in `path` to replace.",
            "type": "string"
          },
          "path": {
            "description": "Absolute path to file or directory, e.g. `/repo/file.py` or `/repo`.",
            "type": "string"
          },
          "view_range": {
            "description": "Optional parameter of `view` command when `path` points to a file. If none is given, the full file is shown. If provided, the file will be shown in the indicated line number range, e.g. [11, 12] will show lines 11 and 12. Indexing at 1 to start. Setting `[start_line, -1]` shows all lines from `start_line` to the end of the file.",
            "items": {"type": "integer"},
            "type": "array"
          }
        },
        "required": ["command", "path"],
        "type": "object"
      }
    },
    {
      "name": "bash",
      "description": "Run commands in a bash shell\n* When invoking this tool, the contents of the \"command\" parameter does NOT need to be XML-escaped.\n* You have access to a mirror of common linux and python packages via apt and pip.\n* State is persistent across command calls and discussions with the user.\n* To inspect a particular line range of a file, e.g. lines 10-25, try 'sed -n 10,25p /path/to/the/file'.\n* Please avoid commands that may produce a very large amount of output.\n* Please run long lived commands in the background, e.g. 'sleep 10 &' or start a server in the background.",
      "parameters": {
        "properties": {
          "command": {
            "description": "The bash command to run. Required unless the tool is being restarted.",
            "type": "string"
          },
          "restart": {
            "description": "Specifying true will restart this tool. Otherwise, leave this unspecified.",
            "type": "boolean"
          }
        },
        "type": "object"
      }
    },
    {
      "name": "create_postgresql_database_tool",
      "description": "Create a PostgreSQL database and set up environment variables",
      "parameters": {
        "properties": {
          "db_name": {
            "description": "Name of the database to create",
            "type": "string"
          }
        },
        "required": ["db_name"],
        "type": "object"
      }
    },
    {
      "name": "suggest_deploy",
      "description": "Suggest deployment of the current project",
      "parameters": {
        "type": "object",
        "properties": {}
      }
    },
    {
      "name": "execute_sql",
      "description": "Execute SQL commands on a PostgreSQL database",
      "parameters": {
        "properties": {
          "query": {
            "description": "SQL query to execute",
            "type": "string"
          }
        },
        "required": ["query"],
        "type": "object"
      }
    },
    {
      "name": "ask_secrets",
      "description": "Request API keys or other secrets from the user",
      "parameters": {
        "properties": {
          "secret_name": {
            "description": "Name of the secret being requested",
            "type": "string"
          },
          "reason": {
            "description": "Reason for needing the secret",
            "type": "string"
          }
        },
        "required": ["secret_name", "reason"],
        "type": "object"
      }
    }
  ],
  "internal_tags": [
    {
      "name": "View",
      "description": "Contains file system information and repository details"
    },
    {
      "name": "policy_spec",
      "description": "Contains communication, proactiveness and data integrity policies"
    },
    {
      "name": "file_system",
      "description": "Shows directory structure"
    },
    {
      "name": "repo_overview",
      "description": "Contains code summaries"
    }
  ]
}</pre>
                    </div>
                </div>
            </div>
            <div class="disclaimer" style="padding: 15px 20px; font-size: 0.75rem; color: var(--text-medium); border-top: 1px solid rgba(224, 224, 224, 0.1); text-align: center;">
                This AI assistant simulates functionality based on Replit's AI models and publicly available information. Tool definitions and operational prompts are adapted from resources provided by Replit, with development assistance from Jules AI. All rights to the original AI models and tools belong to Replit.
            </div>
        </aside>
        
        <div class="editor-area">
            <div class="editor-header">
                <div class="editor-header-left-group">
                    <h2><i class="fas fa-code"></i> Code Editor</h2>
                    <div class="url-fetcher-controls">
                        <input type="text" id="urlInput" placeholder="Enter URL to fetch source...">
                        <button id="fetchUrlButton" class="btn"><i class="fas fa-download"></i> Fetch</button>
                    </div>
                    <div class="layout-controls">
                        <button class="btn layout-btn active" data-layout="default" title="Side-by-side editor and preview"><i class="fas fa-columns"></i></button>
                        <button class="btn layout-btn" data-layout="preview-top" title="Preview on top"><i class="fas fa-layer-group fa-rotate-180"></i></button>
                        <button class="btn layout-btn" data-layout="editor-top" title="Editor on top"><i class="fas fa-layer-group"></i></button>
                    </div>
                </div>
                <div class="panel-actions"> <!-- This will be pushed right by justify-content: space-between on editor-header -->
                    <button class="btn" id="format-btn">
                        <i class="fas fa-redo"></i> Format
                    </button>
                    <button class="btn" id="undo-btn">
                        <i class="fas fa-undo"></i> Undo
                    </button>
                </div>
            </div>
            
            <div class="editor-content">
                <div class="editor-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-file-code"></i> HTML Editor</h3>
                    </div>
                    <div class="panel-content">
                        <textarea class="code-editor" id="html-editor">&lt;!DOCTYPE html&gt;
&lt;html lang="en"&gt;
&lt;head&gt;
  &lt;meta charset="UTF-8"&gt;
  &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
  &lt;title&gt;AI Generated Website&lt;/title&gt;
  &lt;style&gt;
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #1e3a8a, #0f172a);
      color: #f8fafc;
      min-height: 100vh;
      line-height: 1.6;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }
    
    header {
      text-align: center;
      padding: 4rem 1rem;
    }
    
    h1 {
      font-size: 3.5rem;
      margin-bottom: 1rem;
      background: linear-gradient(to right, #4cc9f0, #4361ee);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .subtitle {
      font-size: 1.25rem;
      max-width: 700px;
      margin: 0 auto 2rem;
      color: #cbd5e1;
    }
    
    .cta-button {
      display: inline-block;
      background: #4361ee;
      color: white;
      padding: 12px 30px;
      border-radius: 30px;
      text-decoration: none;
      font-weight: 600;
      font-size: 1.1rem;
      transition: all 0.3s ease;
      border: 2px solid #4cc9f0;
    }
    
    .cta-button:hover {
      background: #3a0ca3;
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
    }
    
    .features {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-top: 4rem;
    }
    
    .feature-card {
      background: rgba(30, 41, 59, 0.6);
      border-radius: 15px;
      padding: 2rem;
      text-align: center;
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(10px);
    }
    
    .feature-card:hover {
      transform: translateY(-10px);
      border-color: #4cc9f0;
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    }
    
    .feature-icon {
      font-size: 3rem;
      margin-bottom: 1.5rem;
      color: #4cc9f0;
    }
    
    .feature-title {
      font-size: 1.5rem;
      margin-bottom: 1rem;
    }
  &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
  &lt;div class="container"&gt;
    &lt;header&gt;
      &lt;h1&gt;AI-Powered Web Development&lt;/h1&gt;
      &lt;p class="subtitle"&gt;Create stunning websites with the help of artificial intelligence. No coding experience required.&lt;/p&gt;
      &lt;a href="#" class="cta-button"&gt;Get Started &lt;i class="fas fa-arrow-right"&gt;&lt;/i&gt;&lt;/a&gt;
    &lt;/header&gt;
    
    &lt;div class="features"&gt;
      &lt;div class="feature-card"&gt;
        &lt;div class="feature-icon"&gt;
          &lt;i class="fas fa-lightning-bolt"&gt;&lt;/i&gt;
        &lt;/div&gt;
        &lt;h3 class="feature-title"&gt;Lightning Fast&lt;/h3&gt;
        &lt;p&gt;Generate responsive websites in seconds using our powerful AI algorithms.&lt;/p&gt;
      &lt;/div&gt;
      
      &lt;div class="feature-card"&gt;
        &lt;div class="feature-icon"&gt;
          &lt;i class="fas fa-cogs"&gt;&lt;/i&gt;
        &lt;/div&gt;
        &lt;h3 class="feature-title"&gt;Advanced Tools&lt;/h3&gt;
        &lt;p&gt;Access a complete suite of development tools powered by AI assistance.&lt;/p&gt;
      &lt;/div&gt;
      
      &lt;div class="feature-card"&gt;
        &lt;div class="feature-icon"&gt;
          &lt;i class="fas fa-mobile-alt"&gt;&lt;/i&gt;
        &lt;/div&gt;
        &lt;h3 class="feature-title"&gt;Fully Responsive&lt;/h3&gt;
        &lt;p&gt;All generated websites work perfectly on any device or screen size.&lt;/p&gt;
      &lt;/div&gt;
    &lt;/div&gt;
  &lt;/div&gt;
  
  &lt;script&gt;
    // Feature card animation
    const cards = document.querySelectorAll('.feature-card');
    cards.forEach(card => {
      card.addEventListener('mouseenter', () => {
        card.style.transform = 'translateY(-10px)';
      });
      
      card.addEventListener('mouseleave', () => {
        card.style.transform = 'translateY(0)';
      });
    });
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</textarea>
                    </div>
                </div>
                
                <div class="preview-panel">
                    <div class="panel-header">
                        <h3><i class="fas fa-eye"></i> Website Preview</h3>
                        <button class="btn" id="refresh-btn">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    <div class="panel-content">
                        <iframe class="preview-iframe" id="website-preview"></iframe>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching functionality
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabPanes = document.querySelectorAll('.tab-pane');
        
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Remove active class from all buttons and panes
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabPanes.forEach(pane => pane.classList.remove('active'));
                
                // Add active class to clicked button
                button.classList.add('active');
                
                // Show corresponding pane
                const tabId = button.getAttribute('data-tab');
                document.getElementById(`${tabId}-tab`).classList.add('active');
            });
        });
        
        // Update preview when code changes
        const htmlEditor = document.getElementById('html-editor');
        const previewFrame = document.getElementById('website-preview');
        
        // Store editor history for undo functionality
        let editorHistory = [];
        let historyIndex = -1;
        
        function updatePreview() {
            const htmlCode = htmlEditor.value;
            const previewDoc = previewFrame.contentDocument || previewFrame.contentWindow.document;
            
            previewDoc.open();
            previewDoc.write(htmlCode);
            previewDoc.close();
        }
        
        // Save editor state to history
        function saveEditorState() {
            // Only save if the content has changed
            if (editorHistory[historyIndex] !== htmlEditor.value) {
                historyIndex++;
                editorHistory[historyIndex] = htmlEditor.value;
                // Truncate history if we're not at the end
                editorHistory = editorHistory.slice(0, historyIndex + 1);
            }
        }
        
        // Undo functionality
        document.getElementById('undo-btn').addEventListener('click', () => {
            if (historyIndex > 0) {
                historyIndex--;
                htmlEditor.value = editorHistory[historyIndex];
                updatePreview();
            }
        });
        
        // Initial preview update and save state
        setTimeout(() => {
            updatePreview();
            saveEditorState();
        }, 100);
        
        // Update preview on code changes
        htmlEditor.addEventListener('input', () => {
            updatePreview();
            saveEditorState();
        });
        
        // Refresh preview
        document.getElementById('refresh-btn').addEventListener('click', updatePreview);
        
        // Run button functionality
        document.getElementById('run-btn').addEventListener('click', () => {
            updatePreview();
            // Show a success notification
            const runBtn = document.getElementById('run-btn');
            const originalText = runBtn.innerHTML;
            runBtn.innerHTML = '<i class="fas fa-check"></i> Running...';
            runBtn.style.background = '#10b981';
            
            setTimeout(() => {
                runBtn.innerHTML = originalText;
                runBtn.style.background = '';
            }, 2000);
        });
        
        // Save button functionality
        document.getElementById('save-btn').addEventListener('click', () => {
            const saveBtn = document.getElementById('save-btn');
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-check"></i> Saved';
            saveBtn.style.background = '#3b82f6';
            
            setTimeout(() => {
                saveBtn.innerHTML = originalText;
                saveBtn.style.background = '';
            }, 2000);
        });
        
        // Format code
        document.getElementById('format-btn').addEventListener('click', () => {
            const formattedCode = htmlEditor.value
                .replace(/\n\s+/g, '\n') // Remove extra indentation
                .replace(/>\s+</g, '><') // Remove spaces between tags
                .replace(/\s{2,}/g, ' '); // Collapse multiple spaces
            
            htmlEditor.value = formattedCode;
            updatePreview();
            saveEditorState();
        });
        
        // Enhanced AI chat functionality
        let REPLIT_TOOLS = []; // Will be populated by loadReplitAiConfig

        // Function to populate REPLIT_TOOLS from a JSON string
        function loadReplitAiConfig(toolsJsonString) { // Now synchronous and takes string
            // AI Attribution Comment
            // This function simulates loading AI tool configurations,
            // based on structures like those provided by Replit.
            try {
                const toolsData = JSON.parse(toolsJsonString);
                if (toolsData && toolsData.tools && Array.isArray(toolsData.tools)) {
                    REPLIT_TOOLS = toolsData.tools.map(tool => ({
                        name: tool.name,
                        description: tool.description
                        // Parameters can be added later: parameters: tool.parameters
                    }));
                    console.log("Replit AI Config loaded from provided JSON. Tools count:", REPLIT_TOOLS.length);
                } else {
                    console.error("Invalid Tools JSON structure after parsing. toolsData:", toolsData);
                    setDefaultTools();
                }
            } catch (error) {
                console.error("Error parsing Tools JSON string:", error);
                setDefaultTools();
            }
        }

        function setDefaultTools() {
            REPLIT_TOOLS = [
                { name: "str_replace_editor", description: "For editing files." },
                { name: "bash", description: "For running shell commands." },
                { name: "Fallback_Tool", description: "Default tool due to loading error."}
            ];
            console.warn("Fell back to default tools because of an error loading/parsing the provided JSON.");
        }

        const chatInput = document.getElementById('chat-input');
        const sendBtn = document.getElementById('send-btn');
        const chatMessages = document.getElementById('chat-messages');
        
        // Handle message sending
        function sendMessage() {
            const message = chatInput.value.trim();
            if (message) {
                // Add user message
                const userMsg = document.createElement('div');
                userMsg.className = 'message user';
                userMsg.innerHTML = `${message}<div class="timestamp">Just now</div>`;
                chatMessages.appendChild(userMsg);
                
                // Clear input
                chatInput.value = '';
                chatInput.focus();
                
                // Add thinking indicator
                const thinkingMsg = document.createElement('div');
                thinkingMsg.className = 'message ai thinking';
                thinkingMsg.innerHTML = `<strong>AI Assistant:</strong> <div class="ai-typing-indicator"><span></span><span></span><span></span></div>`;
                chatMessages.appendChild(thinkingMsg);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Simulate AI processing delay
                setTimeout(() => {
                    // Remove thinking message
                    thinkingMsg.remove();
                    
                    // Generate AI response
                    const aiResponse = generateAIResponse(message);
                    
                    // Add AI response
                    const aiMsg = document.createElement('div');
                    aiMsg.className = 'message ai';
                    
                    let toolsUsedHTML = '';
                    if (aiResponse.tools && aiResponse.tools.length > 0) {
                        toolsUsedHTML = `<div class="tool-used"><i class="fas fa-tools"></i> Used: `;
                        aiResponse.tools.forEach((tool, index) => {
                            toolsUsedHTML += `<span class="ai-tool">${tool}</span>`;
                            if (index < aiResponse.tools.length - 1) toolsUsedHTML += ', ';
                        });
                        toolsUsedHTML += '</div>';
                    }
                    
                    aiMsg.innerHTML = `
                        <strong>AI Assistant:</strong> ${aiResponse.response}
                        ${toolsUsedHTML}
                        <div class="timestamp">Just now</div>
                    `;
                    
                    chatMessages.appendChild(aiMsg);
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    // Execute any action associated with the response
                    if (aiResponse.action) {
                        aiResponse.action();
                        saveEditorState();
                    }
                }, 1500 + Math.random() * 1000);
            }
        }
        
        // Generate AI response based on user input and rules
        function generateAIResponse(message) {
            // AI Attribution Comment
            // This function simulates AI responses and tool usage
            // based on Replit's AI operational model and tool definitions.
            // Development assistance for this simulator by Jules AI.
            const lowerMsg = message.toLowerCase();
            let responseFragment = "";
            let action = null;
            let toolsUsed = [];

            let baseResponse = "As your Replit AI assistant, I'll help you with that. ";

            if (lowerMsg.includes('hello') || lowerMsg.includes('hi')) {
                responseFragment = "Hello! How can I assist you with your project on Replit today?";
                toolsUsed.push(REPLIT_TOOLS.find(t => t.name === "restart_workflow")?.name || "restart_workflow");
            } else if (lowerMsg.includes('dark mode') || lowerMsg.includes('theme')) {
                responseFragment = "I can help you with the dark mode. I'll use the `str_replace_editor` to modify the styles and JavaScript.";
                action = addDarkModeToCode;
                toolsUsed.push(REPLIT_TOOLS.find(t => t.name === "str_replace_editor")?.name || "str_replace_editor");
            } else if (lowerMsg.includes('responsive') || lowerMsg.includes('mobile')) {
                responseFragment = "Making the site responsive is a good idea. I'll use `str_replace_editor` to add the necessary CSS media queries.";
                action = addResponsiveStyles;
                toolsUsed.push(REPLIT_TOOLS.find(t => t.name === "str_replace_editor")?.name || "str_replace_editor");
            } else if (lowerMsg.includes('feature') || lowerMsg.includes('card')) {
                responseFragment = "Adding a feature section sounds good. I'll use `str_replace_editor` to update the HTML structure.";
                action = addFeaturesSection;
                toolsUsed.push(REPLIT_TOOLS.find(t => t.name === "str_replace_editor")?.name || "str_replace_editor");
            } else if (lowerMsg.includes('database') || lowerMsg.includes('postgres')) {
                responseFragment = "For database needs, I can set up a PostgreSQL instance using the `create_postgresql_database_tool`. This will make the necessary environment variables available for your application.";
                action = createDatabase;
                toolsUsed.push(REPLIT_TOOLS.find(t => t.name === "create_postgresql_database_tool")?.name || "create_postgresql_database_tool");
            } else if (lowerMsg.includes('api key') || lowerMsg.includes('secret')) {
                responseFragment = "If you need to use an API key or other secrets, I'll use the `ask_secrets` tool to request them from you. This ensures they are handled securely.";
                action = requestAPIKey;
                toolsUsed.push(REPLIT_TOOLS.find(t => t.name === "ask_secrets")?.name || "ask_secrets");
            } else if (lowerMsg.includes('deploy') || lowerMsg.includes('publish')) {
                responseFragment = "When your project is ready, I can use the `suggest_deploy` tool. Replit Deployments will then handle the rest, making your app live.";
                action = suggestDeployment;
                toolsUsed.push(REPLIT_TOOLS.find(t => t.name === "suggest_deploy")?.name || "suggest_deploy");
            }
            else if (lowerMsg.includes('contact form') || (lowerMsg.includes('add') && lowerMsg.includes('contact'))) {
                responseFragment = "Okay, I can add a contact form to your page. I'll use the `str_replace_editor` to add the necessary HTML and CSS for a basic contact form.";
                action = addContactFormToCode;
                toolsUsed.push(REPLIT_TOOLS.find(t => t.name === "str_replace_editor")?.name || "str_replace_editor");
            }
            else if (lowerMsg.includes('install ') || (lowerMsg.includes('add ') && lowerMsg.includes('package')) || (lowerMsg.includes('use ') && (lowerMsg.includes('library') || lowerMsg.includes('package')))) {
                let packageName = "unspecified_package";
                const installRegex = /install\s+([a-zA-Z0-9_.-]+)/;
                const addRegex = /add\s+([a-zA-Z0-9_.-]+)(\s+package)?/;
                const useRegex = /use\s+([a-zA-Z0-9_.-]+)(\s+(library|package))?/;

                let match;
                if ((match = lowerMsg.match(installRegex)) && match[1]) {
                    packageName = match[1];
                } else if ((match = lowerMsg.match(addRegex)) && match[1]) {
                    packageName = match[1];
                } else if ((match = lowerMsg.match(useRegex)) && match[1]) {
                    packageName = match[1];
                }

                responseFragment = `Okay, I will simulate installing the '${packageName}' package for you. I'll use the \`packager_tool\` for this, as per Replit guidelines.`;
                action = () => simulatePackageInstall(packageName);
                toolsUsed.push(REPLIT_TOOLS.find(t => t.name === "packager_tool")?.name || "packager_tool");
            }
            else if (lowerMsg.includes('file') || lowerMsg.includes('edit') || lowerMsg.includes('change') || lowerMsg.includes('add') || lowerMsg.includes('create')) {
                responseFragment = "I'll use the `str_replace_editor` tool to make those file modifications as you requested.";
                action = editFile;
                toolsUsed.push(REPLIT_TOOLS.find(t => t.name === "str_replace_editor")?.name || "str_replace_editor");
            }
             else if (lowerMsg.includes('tool') || lowerMsg.includes('json')) {
                responseFragment = "All available tools, like `search_filesystem` or `packager_tool`, are configured based on standard Replit capabilities. You can see a representation in the JSON Tools tab. I prioritize these Replit tools.";
            }
            else if (lowerMsg.includes('rule') || lowerMsg.includes('policy')) {
                responseFragment = "I operate based on guidelines for expert software development on Replit, focusing on minimal back-and-forth and using Replit tools effectively. You can see a summary of these principles in the Rules tab.";
            }
            else {
                let foundTool = false;
                for (const tool of REPLIT_TOOLS) {
                    const descriptionWords = tool.description.toLowerCase().split(/\W+/);
                    const messageWords = lowerMsg.split(/\W+/);
                    if (messageWords.some(mw => mw.length > 3 && descriptionWords.some(dw => dw.includes(mw)))) {
                        responseFragment = `Based on your request, the '${tool.name}' tool seems relevant. I'll proceed with that understanding.`;
                        toolsUsed.push(tool.name);
                        action = genericCodeModification;
                        foundTool = true;
                        break;
                    }
                }
                if (!foundTool) {
                    responseFragment = "I'll use my general file editing capabilities (`str_replace_editor`) to address your request.";
                    action = genericCodeModification;
                    toolsUsed.push(REPLIT_TOOLS.find(t => t.name === "str_replace_editor")?.name || "str_replace_editor");
                }
            }

            if (action && toolsUsed.length === 0) {
                toolsUsed.push(REPLIT_TOOLS.find(t => t.name === "str_replace_editor")?.name || "str_replace_editor (default)");
            }
            
            return {
                response: baseResponse + responseFragment,
                tools: toolsUsed,
                action
            };
        }
        
// Add dark mode to code - PROPERLY FIXED
function addDarkModeToCode() {
    const darkModeCSS = `
  body {
    transition: background 0.5s ease, color 0.3s ease;
  }
  
  body.light-mode {
    background: linear-gradient(135deg, #e0e7ff, #c7d2fe);
    color: #1e293b;
  }
  
  .theme-toggle {
    position: fixed;
    top: 20px;
    right: 20px;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.2rem;
    color: #f8fafc;
    transition: all 0.3s ease;
    z-index: 1000;
  }
  
  body.light-mode .theme-toggle {
    background: rgba(30, 41, 59, 0.1);
    color: #1e293b;
  }`;

    const darkModeJS = `
    // Theme toggle functionality
    const themeToggle = document.createElement('button');
    themeToggle.className = 'theme-toggle';
    themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
    document.body.appendChild(themeToggle);
    
    // Check for saved theme preference
    const currentTheme = localStorage.getItem('theme');
    if (currentTheme === 'light') {
      document.body.classList.add('light-mode');
      themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
    }
    
    themeToggle.addEventListener('click', () => {
      document.body.classList.toggle('light-mode');
      if (document.body.classList.contains('light-mode')) {
        localStorage.setItem('theme', 'light');
        themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
      } else {
        localStorage.setItem('theme', 'dark');
        themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
      }
    });`;

    const currentCode = htmlEditor.value;
    
    let newCode = currentCode;
    if (!currentCode.includes('body.light-mode')) {
        const styleTagEnd = newCode.indexOf('</style>');
        if (styleTagEnd !== -1) {
            newCode = newCode.substring(0, styleTagEnd) + 
                      darkModeCSS + 
                      newCode.substring(styleTagEnd);
        }
    }

    if (!currentCode.includes('themeToggle')) {
        const scriptTagEnd = newCode.indexOf('</script>');
        if (scriptTagEnd !== -1) {
            newCode = newCode.substring(0, scriptTagEnd) + 
                      darkModeJS + 
                      newCode.substring(scriptTagEnd);
        }
    }

    if (newCode !== currentCode) {
        htmlEditor.value = newCode;
        updatePreview();
    }
}

function addResponsiveStyles() {
    const responsiveCode = `
    @media (max-width: 768px) {
      .features {
        grid-template-columns: 1fr;
      }
      h1 { font-size: 2.5rem; }
      header { padding: 2rem 1rem; }
      .feature-card { padding: 1.5rem; }
    }
    @media (max-width: 480px) {
      h1 { font-size: 2rem; }
      .subtitle { font-size: 1rem; }
      .cta-button { padding: 10px 20px; font-size: 1rem; }
    }`;
    const currentCode = htmlEditor.value;
    if (!currentCode.includes('@media (max-width: 768px)')) {
        const styleTagEnd = currentCode.indexOf('</style>');
        if (styleTagEnd !== -1) {
            htmlEditor.value = currentCode.substring(0, styleTagEnd) + responsiveCode + currentCode.substring(styleTagEnd);
            updatePreview();
        }
    }
}

function addFeaturesSection() {
    const newFeatureCard = `<div class="feature-card">
        <div class="feature-icon"><i class="fas fa-shield-alt"></i></div>
        <h3 class="feature-title">Secure & Reliable</h3>
        <p>Built with security best practices and reliable infrastructure.</p>
      </div>`;
    const currentCode = htmlEditor.value;
    if (!currentCode.includes('Secure & Reliable')) {
        const featuresContainerEnd = currentCode.indexOf('</div>', currentCode.indexOf('class="features"'));
        if (featuresContainerEnd !== -1) {
            htmlEditor.value = currentCode.substring(0, featuresContainerEnd) + newFeatureCard + currentCode.substring(featuresContainerEnd);
            updatePreview();
        }
    }
}

function createDatabase() {
    const dbCode = `
  // Database connection example (conceptual)
  /*
  const { Pool } = require('pg');
  const pool = new Pool({
    user: process.env.DB_USER,
    host: process.env.DB_HOST,
    database: process.env.DB_NAME,
    password: process.env.DB_PASSWORD,
    port: process.env.DB_PORT,
  });
  async function queryDatabase() {
    try {
      const res = await pool.query('SELECT * FROM users');
      console.log(res.rows);
      return res.rows;
    } catch (err) {
      console.error('Database error:', err);
      throw err;
    }
  }
  */`;
    const currentCode = htmlEditor.value;
    if (!currentCode.includes('Database connection example')) {
        const scriptTagEnd = currentCode.indexOf('</script>');
        if (scriptTagEnd !== -1) {
            htmlEditor.value = currentCode.substring(0, scriptTagEnd) + dbCode + currentCode.substring(scriptTagEnd);
            updatePreview();
        }
    }
}
        
function requestAPIKey() {
    const apiKeyMsg = document.createElement('div');
    apiKeyMsg.className = 'message ai';
    apiKeyMsg.innerHTML = `
        <strong>AI Assistant:</strong> I need an API key to integrate with a service. Please enter it below:
        <div class="api-key-input" style="margin-top: 10px; display: flex; gap: 10px;">
            <input type="text" id="api-key-input" placeholder="Enter API key..." style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid var(--accent-primary); background: var(--bg-darker); color: var(--text-light);">
            <button id="submit-api-key" style="background: var(--accent-primary); border: none; padding: 8px 15px; border-radius: 4px; cursor: pointer; color: var(--text-light);">Submit</button>
        </div>
        <div class="timestamp">Just now</div>`;
    chatMessages.appendChild(apiKeyMsg);
    chatMessages.scrollTop = chatMessages.scrollHeight;

    setTimeout(() => {
        const submitButton = document.getElementById('submit-api-key');
        if (submitButton) {
            submitButton.addEventListener('click', () => {
                const apiKeyInput = document.getElementById('api-key-input');
                if (apiKeyInput && apiKeyInput.value) {
                    const successMsg = document.createElement('div');
                    successMsg.className = 'message ai';
                    successMsg.innerHTML = `<strong>AI Assistant:</strong> API key received! (Simulated storage).<div class="timestamp">Just now</div>`;
                    chatMessages.appendChild(successMsg);
                    apiKeyMsg.remove(); // Remove the input form
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }
            });
        }
    }, 100);
}

function suggestDeployment() {
    const deployMsg = document.createElement('div');
    deployMsg.className = 'message ai';
    deployMsg.innerHTML = `
        <strong>AI Assistant:</strong> Your project looks ready for deployment!
        <div style="margin-top: 10px;">
            <button id="deploy-btn-chat" class="btn" style="background: var(--success); border-color: var(--success); color: white;">
                <i class="fas fa-rocket"></i> Deploy to Replit (Simulated)
            </button>
        </div>
        <div class="timestamp">Just now</div>`;
    chatMessages.appendChild(deployMsg);
    chatMessages.scrollTop = chatMessages.scrollHeight;

    setTimeout(() => {
        const deployButton = document.getElementById('deploy-btn-chat');
        if(deployButton) {
            deployButton.addEventListener('click', () => {
                deployMsg.innerHTML = `<strong>AI Assistant:</strong> Deployment process would be initiated via Replit's platform.<div class="timestamp">Just now</div>`;
                chatMessages.scrollTop = chatMessages.scrollHeight;
            });
        }
    }, 100);
}

function editFile() {
    const editMsg = document.createElement('div');
    editMsg.className = 'message ai';
    editMsg.innerHTML = `<strong>AI Assistant:</strong> I've made the requested file modifications using the \`str_replace_editor\` tool.
        <div class="tool-used"><i class="fas fa-tools"></i> Used: <span class="ai-tool">str_replace_editor</span></div>
        <div class="timestamp">Just now</div>`;
    chatMessages.appendChild(editMsg);
    chatMessages.scrollTop = chatMessages.scrollHeight;

    const currentCode = htmlEditor.value;
    if (!currentCode.includes('<!-- File edited by AI -->')) {
        const comment = '\n    <!-- File edited by AI via str_replace_editor -->';
        const containerEnd = currentCode.lastIndexOf('</div>');
        if (containerEnd !== -1) {
             htmlEditor.value = currentCode.substring(0, containerEnd) + comment + currentCode.substring(containerEnd);
        } else {
            htmlEditor.value += comment;
        }
        updatePreview();
    }
}

function addContactFormToCode() {
    const contactFormHTML = `
    <section class="contact-form-section">
      <h2>Contact Us</h2>
      <form id="contactForm" class="contact-form">
        <div class="form-group">
          <label for="contactName">Name:</label>
          <input type="text" id="contactName" name="contactName" required>
        </div>
        <div class="form-group">
          <label for="contactEmail">Email:</label>
          <input type="email" id="contactEmail" name="contactEmail" required>
        </div>
        <div class="form-group">
          <label for="contactMessage">Message:</label>
          <textarea id="contactMessage" name="contactMessage" rows="5" required></textarea>
        </div>
        <button type="submit" class="btn btn-submit-form">Send Message</button>
      </form>
    </section>`;
    const contactFormCSS = `
    .contact-form-section { padding: 2rem 0; margin-top: 3rem; border-top: 1px solid rgba(224, 224, 224, 0.2); }
    .contact-form-section h2 { text-align: center; margin-bottom: 2rem; color: var(--text-light); }
    .contact-form { max-width: 600px; margin: 0 auto; background: var(--bg-medium); padding: 2rem; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
    .form-group { margin-bottom: 1.5rem; }
    .form-group label { display: block; margin-bottom: 0.5rem; color: var(--text-light); font-weight: 600; }
    .form-group input[type="text"], .form-group input[type="email"], .form-group textarea { width: 100%; padding: 0.75rem; border-radius: 5px; border: 1px solid var(--bg-light-contrast); background: var(--bg-darker); color: var(--text-light); font-size: 1rem; }
    .form-group input[type="text"]:focus, .form-group input[type="email"]:focus, .form-group textarea:focus { border-color: var(--accent-primary); outline: none; }
    .btn-submit-form { background: var(--accent-primary); color: var(--text-light); display: block; width: 100%; padding: 0.75rem; font-size: 1.1rem; }
    .btn-submit-form:hover { background: var(--accent-secondary); }`;

    let currentCode = htmlEditor.value;
    if (currentCode.includes('id="contactForm"')) {
        console.log("Contact form already exists.");
        const chatMessagesContainer = document.getElementById('chat-messages');
        const alreadyExistsMsg = document.createElement('div');
        alreadyExistsMsg.className = 'message ai';
        alreadyExistsMsg.innerHTML = `<strong>AI Assistant:</strong> It looks like a contact form section already exists. I won't add another one.`;
        chatMessagesContainer.appendChild(alreadyExistsMsg);
        chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
        return;
    }
    const styleEnd = currentCode.indexOf('</style>');
    if (styleEnd !== -1) {
        currentCode = currentCode.substring(0, styleEnd) + contactFormCSS + currentCode.substring(styleEnd);
    } else { currentCode += `<style>${contactFormCSS}</style>`; }

    let insertPoint = -1;
    const featuresDiv = currentCode.indexOf('<div class="features">');
    if (featuresDiv !== -1) {
        const endOfFeaturesOuterDiv = currentCode.indexOf('</div>', featuresDiv + '<div class="features">'.length);
        if (endOfFeaturesOuterDiv !== -1) {
             insertPoint = endOfFeaturesOuterDiv + '</div>'.length;
        }
    }
    if (insertPoint === -1) {
        const containerEnd = currentCode.lastIndexOf('</div>', currentCode.indexOf('</body>'));
        if (containerEnd !== -1 && currentCode.substring(containerEnd-20, containerEnd).includes("container")) {
           insertPoint = containerEnd + '</div>'.length;
        }
    }
    if (insertPoint === -1 && currentCode.includes('</body>')) { insertPoint = currentCode.indexOf('</body>'); }
    else if (insertPoint === -1) { insertPoint = currentCode.length; }
    currentCode = currentCode.substring(0, insertPoint) + contactFormHTML + currentCode.substring(insertPoint);
    htmlEditor.value = currentCode;
    updatePreview();
}

function simulatePackageInstall(packageName) {
    if (!packageName) { packageName = "a requested package"; }
    console.log(`Simulating: packager_tool installed ${packageName}`);
    const comment = `\n<!-- Simulated package install: ${packageName} (using packager_tool) -->`;
    let currentCode = htmlEditor.value;
    let insertPosition = currentCode.indexOf('</head>');
    if (insertPosition === -1) { insertPosition = currentCode.length; }
    const newCode = currentCode.substring(0, insertPosition) + comment + currentCode.substring(insertPosition);
    if (htmlEditor.value !== newCode) {
        htmlEditor.value = newCode;
        updatePreview();
    }
    const chatMessagesContainer = document.getElementById('chat-messages');
    const simMsg = document.createElement('div');
    simMsg.className = 'message ai';
    simMsg.innerHTML = `<strong>AI Assistant (System):</strong> Simulated installation of '${packageName}' using packager_tool. A comment has been added to the HTML.`;
    chatMessagesContainer.appendChild(simMsg);
    chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
}
        
        // Event listeners for chat
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
        
        sendBtn.addEventListener('click', sendMessage);
        
        // Layout Picker Functionality
        const layoutButtons = document.querySelectorAll('.layout-btn');
        const editorArea = document.querySelector('.editor-area');

        layoutButtons.forEach(button => {
            button.addEventListener('click', () => {
                layoutButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                const layout = button.getAttribute('data-layout');
                editorArea.classList.remove('layout-default', 'layout-preview-top', 'layout-editor-top');
                if (layout !== 'default') {
                    editorArea.classList.add(`layout-${layout}`);
                }
            });
        });

        // URL Fetcher Functionality
        const urlInput = document.getElementById('urlInput');
        const fetchUrlButton = document.getElementById('fetchUrlButton');

        if (fetchUrlButton) { // Ensure button exists before adding listener
            fetchUrlButton.addEventListener('click', async () => {
                const url = urlInput.value.trim();
                const chatMessagesContainer = document.getElementById('chat-messages'); // Define here for broader scope in this listener

                if (!url) {
                    const errorMsg = document.createElement('div');
                    errorMsg.className = 'message ai';
                    errorMsg.innerHTML = `<strong>AI Assistant:</strong> Please enter a URL to fetch.`;
                    chatMessagesContainer.appendChild(errorMsg);
                    chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
                    urlInput.focus();
                    return;
                }

                const thinkingMsg = document.createElement('div');
                thinkingMsg.className = 'message ai thinking';
                thinkingMsg.innerHTML = `<strong>AI Assistant:</strong> Fetching source for ${url}... <div class="ai-typing-indicator"><span></span><span></span><span></span></div>`;
                chatMessagesContainer.appendChild(thinkingMsg);
                chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;

                try {
                    // This is a placeholder for the AI (Jules) using its view_text_website tool.
                    // The actual tool call would happen in the AI's environment, not directly in client-side JS.
                    // This simulation demonstrates the UI flow.
                    let fetchedHtml;
                    let success = false;

                    // Simulate a successful fetch for example.com or any http/https URL for demo purposes
                    if (url.toLowerCase() === "https://example.com") {
                        fetchedHtml = `<!DOCTYPE html>
<html>
<head>
<title>Example Domain</title>
<meta charset="utf-8" />
<meta http-equiv="Content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style type="text/css">
body { background-color: #f0f0f2; margin: 0; padding: 0; font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; }
div { width: 600px; margin: 5em auto; padding: 2em; background-color: #fdfdff; border-radius: 0.5em; box-shadow: 2px 3px 7px 2px rgba(0,0,0,0.02); }
a:link, a:visited { color: #38488f; text-decoration: none; }
@media (max-width: 700px) { div { margin: 0 auto; width: auto; } }
</style>
</head>
<body>
<div>
    <h1>Example Domain</h1>
    <p>This domain is for use in illustrative examples in documents. You may use this
    domain in literature without prior coordination or asking for permission.</p>
    <p><a href="https://www.iana.org/domains/example">More information...</a></p>
</div>
</body>
</html>`;
                        success = true;
                    } else if (url.startsWith("http://") || url.startsWith("https://")) {
                         fetchedHtml = `<!DOCTYPE html><html><head><title>Simulated Page: ${url}</title></head><body><h1>Simulated content for ${url}</h1><p>This is placeholder content as direct cross-origin fetching is restricted in browser-run JavaScript. The AI would use its 'view_text_website' tool to get actual content.</p></body></html>`;
                         success = true;
                    } else {
                        // Consider it a failure if not matching example.com or starting with http(s) for this simulation
                        success = false;
                    }

                    thinkingMsg.remove();

                    if (success) {
                        htmlEditor.value = fetchedHtml;
                        updatePreview();
                        saveEditorState();

                        const successChatMsg = document.createElement('div');
                        successChatMsg.className = 'message ai';
                        successChatMsg.innerHTML = `<strong>AI Assistant:</strong> Successfully fetched and displayed source for: ${url}`;
                        chatMessagesContainer.appendChild(successChatMsg);
                    } else {
                        const errorChatMsg = document.createElement('div');
                        errorChatMsg.className = 'message ai';
                        errorChatMsg.style.borderColor = 'var(--danger)';
                        errorChatMsg.innerHTML = `<strong>AI Assistant:</strong> Could not fetch source for '${url}'. (Simulated - ensure URL is valid like 'https://example.com' or starts with http/https).`;
                        chatMessagesContainer.appendChild(errorChatMsg);
                    }
                    chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;

                } catch (error) {
                    thinkingMsg.remove();
                    console.error("Error in fetch URL simulation:", error);
                    const errorChatMsg = document.createElement('div');
                    errorChatMsg.className = 'message ai';
                    errorChatMsg.style.borderColor = 'var(--danger)';
                    errorChatMsg.innerHTML = `<strong>AI Assistant:</strong> An error occurred: ${error.message}`;
                    chatMessagesContainer.appendChild(errorChatMsg);
                    chatMessagesContainer.scrollTop = chatMessagesContainer.scrollHeight;
                }
            });
        }


        // Initialize: Load AI config, then focus chat input.
        const initialToolsJson = `{
  "tools": [
    {
      "name": "restart_workflow",
      "description": "Restart (or start) a workflow.",
      "parameters": { "properties": { "name": { "description": "The name of the workflow.", "type": "string" } }, "required": ["name"], "type": "object" }
    },
    {
      "name": "search_filesystem",
      "description": "This tools searches and opens the relevant files for a codebase",
      "parameters": { "properties": { "class_names": { "default": [], "description": "List of specific class names to search for in the codebase. Case-sensitive and supports exact matches only. Use this to find particular class definitions or their usages.", "items": {"type": "string"}, "type": "array" }, "code": { "default": [], "description": "List of exact code snippets to search for in the codebase. Useful for finding specific implementations or patterns. Each snippet should be a complete code fragment, not just keywords.", "items": {"type": "string"}, "type": "array" }, "function_names": { "default": [], "description": "List of specific function or method names to search for. Case-sensitive and supports exact matches only. Use this to locate function definitions or their invocations throughout the code.", "items": {"type": "string"}, "type": "array" }, "query_description": { "anyOf": [{"type": "string"}, {"type": "null"}], "default": null, "description": "A natural language query to perform semantic similarity search. Describe what you're looking for using plain English, e.g. 'find error handling in database connections' or 'locate authentication middleware implementations'." } }, "type": "object" }
    },
    {
      "name": "packager_tool",
      "description": "Installs the language (if needed) and installs or uninstalls a list of libraries or project dependencies. Use this tool to install dependencies instead of executing shell commands, or editing files manually. Use this tool with language_or_system=\`system\` to add system-dependencies instead of using \`apt install\`. Installing libraries for the first time also creates the necessary project files automatically (like 'package.json', 'cargo.toml', etc). This will automatically reboot all workflows.",
      "parameters": { "properties": { "dependency_list": { "default": [], "description": "The list of system dependencies or libraries to install. System dependencies are packages (attribute paths) in the Nixpkgs package collection. Example system dependencies: ['jq', 'ffmpeg', 'imagemagick']. Libraries are packages for a particular programming language. Example libraries: ['express'], ['lodash'].", "items": {"type": "string"}, "type": "array" }, "install_or_uninstall": { "description": "Whether to install or uninstall.", "enum": ["install", "uninstall"], "type": "string" }, "language_or_system": { "description": "The language for which to install/uninstall libraries, for example  'nodejs', 'bun', 'python', etc. Use \`system\` to install/uninstall system dependencies.", "type": "string" } }, "required": ["install_or_uninstall", "language_or_system"], "type": "object" }
    },
    {
      "name": "programming_language_install_tool",
      "description": "If a program doesn't run, you may not have the programming language installed. Use programming_language_install_tool to install it. If you need to use python, include 'python-3.11' in programming_languages. For Python 3.10, use 'python-3.10'. If you need to use Node.js, include 'nodejs-20' in programming_languages. For Node.js 18, use 'nodejs-18'. Note, this will also install the language's package manager, so don't install it separately.",
      "parameters": { "properties": { "programming_languages": { "description": "IDs of the programming languages to install", "items": {"type": "string"}, "type": "array" } }, "required": ["programming_languages"], "type": "object" }
    },
    {
      "name": "create_postgresql_database_tool",
      "description": "When a project requires a PostgreSQL database, you can use this tool to create a database for it. After successfully creating a database, you will have access to the following environment variables: DATABASE_URL, PGPORT, PGUSER, PGPASSWORD, PGDATABASE, PGHOST\\nYou can use these environment variables to connect to the database in your project.",
      "parameters": { "properties": {}, "type": "object" }
    },
    {
      "name": "check_database_status",
      "description": "Check if given databases are available and accessible.\\nThis tool is used to verify the connection and status of specified databases.",
      "parameters": { "properties": {}, "type": "object" }
    },
    {
      "name": "str_replace_editor",
      "description": "Custom editing tool for viewing, creating and editing files\\n* State is persistent across command calls and discussions with the user\\n* If \`path\` is a file, \`view\` displays the result of applying \`cat -n\`. If \`path\` is a directory, \`view\` lists non-hidden files and directories up to 2 levels deep\\n* The \`create\` command cannot be used if the specified \`path\` already exists as a file\\n* If a \`command\` generates a long output, it will be truncated and marked with \`<response clipped>\` \\n* The \`undo_edit\` command will revert the last edit made to the file at \`path\`\\n\\nNotes for using the \`str_replace\` command:\\n* The \`old_str\` parameter should match EXACTLY one or more consecutive lines from the original file. Be mindful of whitespaces!\\n* If the \`old_str\` parameter is not unique in the file, the replacement will not be performed. Make sure to include enough context in \`old_str\` to make it unique\\n* The \`new_str\` parameter should contain the edited lines that should replace the \`old_str\`",
      "parameters": { "properties": { "command": { "description": "The commands to run. Allowed options are: \`view\`, \`create\`, \`str_replace\`, \`insert\`, \`undo_edit\`.", "enum": ["view", "create", "str_replace", "insert", "undo_edit"], "type": "string" }, "file_text": { "description": "Required parameter of \`create\` command, with the content of the file to be created.", "type": "string" }, "insert_line": { "description": "Required parameter of \`insert\` command. The \`new_str\` will be inserted AFTER the line \`insert_line\` of \`path\`.", "type": "integer" }, "new_str": { "description": "Optional parameter of \`str_replace\` command containing the new string (if not given, no string will be added). Required parameter of \`insert\` command containing the string to insert.", "type": "string" }, "old_str": { "description": "Required parameter of \`str_replace\` command containing the string in \`path\` to replace.", "type": "string" }, "path": { "description": "Absolute path to file or directory, e.g. \`/repo/file.py\` or \`/repo\`.", "type": "string" }, "view_range": { "description": "Optional parameter of \`view\` command when \`path\` points to a file. If none is given, the full file is shown. If provided, the file will be shown in the indicated line number range, e.g. [11, 12] will show lines 11 and 12. Indexing at 1 to start. Setting \`[start_line, -1]\` shows all lines from \`start_line\` to the end of the file.", "items": {"type": "integer"}, "type": "array" } }, "required": ["command", "path"], "type": "object" }
    },
    {
      "name": "bash",
      "description": "Run commands in a bash shell\\n* When invoking this tool, the contents of the \\"command\\" parameter does NOT need to be XML-escaped.\\n* You have access to a mirror of common linux and python packages via apt and pip.\\n* State is persistent across command calls and discussions with the user.\\n* To inspect a particular line range of a file, e.g. lines 10-25, try 'sed -n 10,25p /path/to/the/file'.\\n* Please avoid commands that may produce a very large amount of output.\\n* Please run long lived commands in the background, e.g. 'sleep 10 &' or start a server in the background.",
      "parameters": { "properties": { "command": { "description": "The bash command to run. Required unless the tool is being restarted.", "type": "string" }, "restart": { "description": "Specifying true will restart this tool. Otherwise, leave this unspecified.", "type": "boolean" } }, "type": "object" }
    },
    {
      "name": "workflows_set_run_config_tool",
      "description": "Configure a background task that executes a shell command.\\nThis is useful for starting development servers, build processes, or any other\\nlong-running tasks needed for the project.\\nIf this is a server, ensure you specify the port number it listens on in the \`wait_for_port\` field so\\nthe workflow isn't considered started until the server is ready to accept connections.\\n\\nExamples:\\n- For a Node.js server: set \`name\` to 'Server', \`command\` to 'npm run dev', and \`wait_for_port\` to 5000\\n- For a Python script: set name to 'Data Processing' and command to 'python process_data.py'\\n\\nMultiple tasks can be configured and they will all execute in parallel when the project is started.\\nAfter configuring a task, it will automatically start executing in the background.\\n\\nALWAYS serve the app on port 5000, even if there are problems serving that port: it is the only port that is not firewalled.\\n",
      "parameters": { "properties": { "command": { "description": "The shell command to execute. This will run in the background when the project is started.", "type": "string" }, "name": { "description": "A unique name to identify the command. This will be used to keep a track of the command.", "type": "string" }, "wait_for_port": { "anyOf": [{"type": "integer"}, {"type": "null"}], "default": null, "description": "If the command starts a process that listens on a port, specify the port number here.\\nThis allows the system to wait for the port to be ready before considering the command fully started." } }, "required": ["name", "command"], "type": "object" }
    },
    {
      "name": "workflows_remove_run_config_tool",
      "description": "Remove previously added named command",
      "parameters": { "properties": { "name": { "description": "The name of the command to remove.", "type": "string" } }, "required": ["name"], "type": "object" }
    },
    {
      "name": "execute_sql_tool",
      "description": "This tool allows you to execute SQL queries, fix database errors and access the database schema.\\n\\n## Rules of usage:\\n1. Always prefer using this tool to fix database errors vs fixing by writing code like db.drop_table(table_name)\\n2. Provide clear, well-formatted SQL queries with proper syntax\\n3. Focus on database interactions, data manipulation, and query optimization\\n\\n## When to use:\\n1. To fix and troubleshoot database-related issues\\n2. To explore database schema and relationships\\n3. To update or modify data in the database\\n4. To run ad-hoc single-use SQL code\\n\\n## When not to use:\\n1. For non-SQL database operations (NoSQL, file-based databases)\\n2. For database migrations. Use a migration tool like Drizzle or flask-migrate instead\\n\\n## Example usage:\\n\\n### Example 1: Viewing database information\\nsql_query: SELECT * FROM customers WHERE region = 'North';\\n\\n### Example 2: Running ad-hoc SQL queries\\nsql_query:  EXPLAIN ANALYZE SELECT orders.*, customers.name\\n            FROM orders\\n            JOIN customers ON orders.customer_id = customers.id;\\n\\n### Example 3: Inserting data into the database\\nsql_query:  INSERT INTO products (name, price, category)\\n            VALUES ('New Product', 29.99, 'Electronics');",
      "parameters": { "properties": { "sql_query": { "description": "The SQL query to be executed", "type": "string" } }, "required": ["sql_query"], "type": "object" }
    },
    {
      "name": "suggest_deploy",
      "description": "Call this function when you think the project is in a state ready for deployment.\\nThis will suggest to the user that they can deploy their project.\\nThis is a terminal action - once called, your task is complete and\\nyou should not take any further actions to verify the deployment.\\nThe deployment process will be handled automatically by Replit Deployments.\\n\\n## Rules of usage:\\n1. Use this tool once you've validated that the project works as expected.\\n2. The deployment process will be handled automatically by Replit Deployments.\\n\\n## When to use:\\n1. When the project is ready for deployment.\\n2. When the user asks to deploy the project.\\n\\n## More information:\\n- The user needs to manually initiate the deployment.\\n- Replit Deployments will handle building the application, hosting, TLS, health checks.\\n- Once this tool is called, there is no need to do any follow up steps or verification.\\n- Once deployed, the app will be available under a \`.replit.app\` domain,\\n  or a custom domain if one is configured.",
      "parameters": { "description": "Empty parameters class since suggest deploy doesn't need any parameters.", "properties": {}, "type": "object" }
    },
    {
      "name": "report_progress",
      "description": "Call this function once the user explicitly confirms that a major feature or task is complete.\\nDo not call it without the user's confirmation.\\nProvide a concise summary of what was accomplished in the 'summary' field.\\nThis tool will ask user for the next thing to do. Don't do anything after this tool.",
      "parameters": { "properties": { "summary": { "description": "Summarize your recent changes in a maximum of 5 items. Be really concise, use no more than 30 words. Break things into multiple lines.\\nPut a \\u2713 before every item you've done recently and \\u2192 for the items in progress, be very short and concise, don't use more than 50 words. Don't use emojis.\\nUse simple, everyday language that matches the user's language. Avoid technical terms, as users are non-technical.\\nAsk user what to do next in the end.", "type": "string" } }, "required": ["summary"], "type": "object" }
    },
    {
      "name": "web_application_feedback_tool",
      "description": "This tool captures a screenshot and checks logs to verify whether the web application is running in the Replit workflow.\\n\\nIf the application is running, the tool displays the app, asks user a question, and waits for user's response.\\nUse this tool when the application is in a good state and the requested task is complete to avoid unnecessary delays.",
      "parameters": { "properties": { "query": { "description": "The question you will ask the user.\\n\\nUse simple, everyday language that matches the user's language. Avoid technical terms, as users are non-technical.\\nSummarize your recent changes in a maximum of 5 items. Be really concise, use no more than 30 words. Break things into multiple lines.\\nPut a \\u2713 before every item you've done recently and \\u2192 for the items in progress, be very short and concise, don't use more than 50 words. Don't use emojis.\\nLimit yourself to asking only one question at a time.\\nYou have access to workflow state, console logs, and screenshots\\u2014retrieve them yourself instead of asking the user.\\nAsk for user input or confirmation on next steps. Do not request details.", "type": "string" }, "website_route": { "anyOf": [{"type": "string"}, {"type": "null"}], "default": null, "description": "The specific route or path of the website you're asking about, if it's different from the root URL ('/'). Include the leading slash. Example: '/dashboard' or '/products/list'" }, "workflow_name": { "description": "The name of the workflow running the server. Used to determine the port of the website.", "type": "string" } }, "required": ["query", "workflow_name"], "type": "object" }
    },
    {
      "name": "shell_command_application_feedback_tool",
      "description": "This tool allows you to execute interactive shell commands and ask questions about the output or behavior of CLI applications or interactive Python programs.\\n\\n## Rules of usage:\\n1. Provide clear, concise interactive commands to execute and specific questions about the results or interaction.\\n2. Ask one question at a time about the interactive behavior or output.\\n3. Focus on interactive functionality, user input/output, and real-time behavior.\\n4. Specify the exact command to run, including any necessary arguments or flags to start the interactive session.\\n5. When asking about Python programs, include the file name and any required command-line arguments to start the interactive mode.\\n\\n## When to use:\\n1. To test and verify the functionality of interactive CLI applications or Python programs where user input and real-time interaction are required.\\n2. To check if a program responds correctly to user input in an interactive shell environment.\\n\\n## When not to use:\\n1. For non-interactive commands or scripts that don't require user input.\\n2. For API testing or web-based interactions.\\n3. For shell commands that open a native desktop VNC window.\\n\\n## Example usage:\\nCommand: python interactive_script.py\\nQuestion: When prompted, can you enter your name and receive a personalized greeting?\\n\\nCommand: ./text_adventure_game\\nQuestion: Are you able to make choices that affect the story progression?\\n\\nCommand: python -i data_analysis.py\\nQuestion: Can you interactively query and manipulate the loaded data set?",
      "parameters": { "properties": { "query": { "description": "The question or feedback request about the shell application", "type": "string" }, "shell_command": { "description": "The shell command to be executed before asking for feedback", "type": "string" }, "workflow_name": { "description": "The workflow name for this command, must be an existing workflow.", "type": "string" } }, "required": ["query", "shell_command", "workflow_name"], "type": "object" }
    },
    {
      "name": "vnc_window_application_feedback",
      "description": "This tool allows you to execute interactive desktop application, which will be accessed through VNC and displayed to the user.\\nYou can ask questions about the output or behavior of this application.\\n\\n## Rules of usage:\\n1. Provide clear, concise command to execute the application, and specific questions about the results or interaction.\\n2. Ask one question at a time about the interactive behavior or output.\\n3. Focus on interactive functionality, user input/output, and real-time behavior.\\n4. Specify the exact command to run, including any necessary arguments or flags.\\n\\n## When to use:\\n1. To test and verify the functionality of interactive desktop programs, where user input and real-time interactions are required.\\n2. To check if a program responds correctly to user input in an attached VNC window.\\n\\n## When not to use:\\n1. For non-interactive commands or scripts that don't require user input.\\n2. For API testing or web-based interactions.\\n3. For shell commands that don't open a native desktop VNC window.\\n\\n## Example usage:\\nCommand: python pygame_snake.py\\nQuestion: Do the keyboard events change the snake direction on the screen?\\n\\nCommand: ./opencv_face_detection\\nQuestion: Do you see a photo with green rectangles around detected faces?",
      "parameters": { "properties": { "query": { "description": "The question or feedback request about a native window application, visible through VNC", "type": "string" }, "vnc_execution_command": { "description": "The VNC shell command to be executed before asking for feedback; this shell command should spawn the desktop window", "type": "string" }, "workflow_name": { "description": "The workflow name for this VNC shell command, must be an existing workflow.", "type": "string" } }, "required": ["query", "vnc_execution_command", "workflow_name"], "type": "object" }
    },
    {
      "name": "ask_secrets",
      "description": "Ask user for the secret API keys needed for the project.\\nIf a secret is missing, use this tool as soon as possible.\\nThe secrets will be added to environment variables.\\nThis tool is very expensive to run.\\n\\nGOOD Examples:\\n- To set up secure payments with Stripe, we need a STRIPE_SECRET_KEY.\\n  This key will be used to securely process payments and\\n  manage subscriptions in your application.\\n- To enable SMS price alerts, we need Twilio API credentials TWILIO_ACCOUNT_SID,\\n  TWILIO_AUTH_TOKEN, and TWILIO_PHONE_NUMBER. These will be used to send SMS\\n  notifications when price targets are reached.\\n- To build applications using OpenAI models we need an OPENAI_API_KEY.\\n\\nBAD Examples (Do Not Use):\\n- PHONE_NUMBER, EMAIL_ADDRESS, or PASSWORD\\n    for this type of variables, you should ask the user directly\\n    through the user_response tool.\\n- REPLIT_DOMAINS or REPL_ID\\n    these secrets are always present, so you never need to ask for\\n    them.\\n",
      "parameters": { "properties": { "secret_keys": { "description": "Array of secret key identifiers needed for the project (e.g., [\\"OPENAI_API_KEY\\", \\"GITHUB_TOKEN\\"])", "items": {"type": "string"}, "type": "array" }, "user_message": { "description": "The message to send back to the user explaining the reason for needing these secret keys. If you haven't already, briefly introduce what a secret key is in general terms, assume the user never registered for an API key before. Please phrase your question respectfully.", "type": "string" } }, "required": ["secret_keys", "user_message"], "type": "object" }
    },
    {
      "name": "check_secrets",
      "description": "Check if a given secret exists in the environment.\\nThis tool is used to verify the presence of a secret without exposing its actual value.\\n",
      "parameters": { "properties": { "secret_keys": { "description": "The secret keys to check in the environment.", "items": {"type": "string"}, "type": "array" } }, "required": ["secret_keys"], "type": "object" }
    }
  ],
  "internal_tags": [
    { "name": "View", "description": "Contains file system information and repository details" },
    { "name": "policy_spec", "description": "Contains communication, proactiveness and data integrity policies" },
    { "name": "file_system", "description": "Shows directory structure" },
    { "name": "repo_overview", "description": "Contains code summaries" },
    { "name": "important", "description": "Contains key policy reminders" },
    { "name": "workflow_console_logs", "description": "Contains logs from running workflows" },
    { "name": "automatic_updates", "description": "Contains system-generated updates" },
    { "name": "webview_console_logs", "description": "Contains logs from the user's browser" },
    { "name": "function_results", "description": "Contains results of function/tool calls" }
  ]
}`;
        loadReplitAiConfig(initialToolsJson); // Load the new full JSON
        document.getElementById('json-tools').textContent = JSON.stringify(JSON.parse(initialToolsJson), null, 2); // Update display
        chatInput.focus();
        console.log("AI Config loaded from full JSON string, chat focused, JSON tab updated.");


        // Contact Form Submission Handler (Client-side)
        document.body.addEventListener('submit', function(event) {
            if (event.target.id === 'contactForm') {
                event.preventDefault(); // Prevent actual submission

                const existingSuccessMsg = document.getElementById('contactFormSuccessMsg');
                if (existingSuccessMsg) {
                    existingSuccessMsg.remove();
                }

                const successMsg = document.createElement('p');
                successMsg.id = 'contactFormSuccessMsg';
                successMsg.textContent = 'Message sent successfully! (This is a demo - no actual email was sent.)';
                successMsg.style.color = 'var(--success)';
                successMsg.style.marginTop = '1rem';
                successMsg.style.textAlign = 'center';

                const formParent = event.target.parentNode;
                if (formParent) {
                    formParent.appendChild(successMsg);
                } else {
                    event.target.insertAdjacentElement('afterend', successMsg);
                }

                event.target.reset();
            }
        });
    </script>
</body>
</html>
